services:
  - type: web
    name: gaf-rtdls
    runtime: python
    rootDir: .
    buildCommand: "pip install -r requirements.txt && python manage.py collectstatic --noinput"
    preDeployCommand: "python manage.py migrate --noinput"
    startCommand: "gunicorn rtdls.asgi:application -k uvicorn.workers.UvicornWorker --bind 0.0.0.0:$PORT --workers ${WEB_CONCURRENCY:-2} --timeout 120 --access-logfile - --error-logfile -"
    healthCheckPath: /healthz/
    envVars:
      - key: DEBUG
        value: "False"
      - key: SECRET_KEY
        generateValue: true
      - key: ALLOWED_HOSTS
        sync: false
      - key: CSRF_TRUSTED_ORIGINS
        sync: false
      - key: WEB_CONCURRENCY
        value: "2"
      - key: DRF_LOGIN_THROTTLE_RATE
        value: "10/minute"
      - key: REPORTS_FLIGHT_ID_OPTIONS_LIMIT
        value: "40"
      - key: DATABASE_URL
        fromDatabase:
          name: gaf-rtdls-db
          property: connectionString
      - key: REDIS_URL
        fromService:
          type: keyvalue
          name: gaf-rtdls-redis
          property: connectionString
      - key: RECAPTCHA_ENABLED
        value: "True"
      - key: RECAPTCHA_SITE_KEY
        sync: false
      - key: RECAPTCHA_SECRET_KEY
        sync: false
      - key: RECAPTCHA_VERIFY_URL
        value: "https://www.google.com/recaptcha/api/siteverify"
      - key: RECAPTCHA_TIMEOUT_SECONDS
        value: "5"
      - key: OPENSKY_STATES_URL
        value: "https://opensky-network.org/api/states/all"
      - key: OPENSKY_TIMEOUT_SECONDS
        value: "8"
      - key: OPENSKY_DEFAULT_SCOPE
        value: "africa"
      - key: OPENSKY_DEMO_FALLBACK
        value: "True"
      - key: OPENSKY_USERNAME
        sync: false
      - key: OPENSKY_PASSWORD
        sync: false

  - type: keyvalue
    name: gaf-rtdls-redis
    plan: free

databases:
  - name: gaf-rtdls-db
    plan: free
